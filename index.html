<!DOCTYPE html>
<html lang="fr">
<head>
 <style>
  @keyframes slide-in-right {
    from {
      transform: translateX(100%);
    }
    to {
      transform: translateX(0);
    }
  }
  .animate-slide-in-right {
    animation: slide-in-right 0.3s ease-out;
  }
</style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>P-Shop</title>
  <!-- PWA -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#ec4899">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="https://i.postimg.cc/ZRscyVKS/b4beb632-78c8-4f8d-8491-02da1b2545ee.png">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDK v9 Compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <script>
    // Configuration Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAsgQfVmNvzNpu9L8LkefHR5IBI_QiwAV4",
      authDomain: "p-shop-6afae.firebaseapp.com",
      projectId: "p-shop-6afae",
      storageBucket: "p-shop-6afae.firebasestorage.app",
      messagingSenderId: "996187114750",
      appId: "1:996187114750:web:79d30a82bc47f502a169af"
    };

    // Initialiser Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Rendre disponible globalement
    window.firestoreDb = db;
  </script>
</head>
<body class="bg-black">
  <div id="root"></div>
  
  <style>
    body {
      padding-top: env(safe-area-inset-top);
      background-color: #0a0a1a;
      overflow-x: hidden;
    }
    
    html, body, #root {
      margin: 0;
      padding: 0;
      width: 100%;
      min-height: 100vh;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
  </style>
  
  <script type="text/babel">
    const { useState, useMemo, useCallback, useEffect } = React;

    // ==================== üîß FONCTION DE DEBUGGING AM√âLIOR√âE ====================
    const debugLog = (message, data) => {
      console.log(`üîç [P-SHOP DEBUG] ${message}`, data || '');
    };

    // ==================== CONFIGURATION ====================
    const INITIAL_FLAVORS = [
      'Sakura Grape 16k', 'Blue Razz Ice 16k', 'Cherry Berry 16k',
      'Summer Peach Ice 16k', 'Berry Burst 16k', 'Watermelon Ice 16k',
      'Coca', 'Grape Ice 18k', 'Mango Ice', 'Strawberry Kiwi'
    ];

    const LOYALTY_TIERS = [
      { name: 'Platine', minPoints: 0, color: 'from-purple-500 to-pink-400' },
      { name: 'Premium', minPoints: 1500, color: 'from-yellow-500 via-orange-500 to-red-500' }
    ];

    const S = {
      btn: "font-bold py-3 px-4 rounded-xl transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-50 hover:scale-105 hover:shadow-2xl",
      primary: "bg-gradient-to-r from-cyan-500 via-pink-500 to-purple-600 text-white hover:from-cyan-400 hover:via-pink-400 hover:to-purple-500 shadow-[0_0_20px_rgba(0,240,255,0.5)]",
      secondary: "bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 border border-cyan-500/50 backdrop-blur-sm",
      input: "w-full bg-black/40 border-2 border-cyan-500/30 rounded-xl p-3 text-white placeholder-cyan-300/50 focus:border-cyan-400 focus:shadow-[0_0_15px_rgba(0,240,255,0.3)] transition-all backdrop-blur-sm",
      card: "bg-black/60 backdrop-blur-xl rounded-2xl border-2 border-cyan-500/30 overflow-hidden shadow-[0_0_40px_rgba(0,240,255,0.2)] hover:shadow-[0_0_60px_rgba(0,240,255,0.4)] transition-all duration-300"
    };

    // ==================== üî• FIRESTORE AM√âLIOR√â ====================
    const saveToFirestore = async (collection, data) => {
      try {
        debugLog(`Tentative sauvegarde ${collection}`, { itemCount: Array.isArray(data) ? data.length : 'N/A' });
        
        if (collection === 'pshop_products' || collection === 'pshop_users') {
          const batch = db.batch();
          const snapshot = await db.collection(collection).get();
          
          snapshot.docs.forEach(doc => {
            batch.delete(doc.ref);
          });
          
          data.forEach(item => {
            const docId = collection === 'pshop_users' ? item.name : String(item.id);
            const docRef = db.collection(collection).doc(docId);
            batch.set(docRef, item);
          });
          
          await batch.commit();
          debugLog(`‚úÖ Sauvegarde ${collection} r√©ussie`, { items: data.length });
          return;
        }
        
        await db.collection(collection).doc('data').set({ value: data });
        debugLog(`‚úÖ Sauvegarde ${collection} r√©ussie`);
      } catch (error) {
        console.error(`‚ùå Erreur sauvegarde ${collection}:`, error);
        alert(`Erreur de sauvegarde: ${error.message}`);
      }
    };

    const loadFromFirestore = async (collection, defaultValue) => {
      try {
        debugLog(`Chargement de ${collection}...`);
        
        if (collection === 'pshop_products' || collection === 'pshop_users') {
          const snapshot = await db.collection(collection).get();
          
          if (!snapshot.empty) {
            const items = snapshot.docs.map(doc => {
              const data = doc.data();
              debugLog(`Item charg√© de ${collection}:`, data);
              return data;
            });
            
            debugLog(`‚úÖ ${collection} charg√©`, { count: items.length });
            return items;
          }
          
          debugLog(`‚ö†Ô∏è ${collection} vide`);
          return defaultValue;
        }
        
        const doc = await db.collection(collection).doc('data').get();
        if (doc.exists) {
          debugLog(`‚úÖ ${collection} charg√©`);
          return doc.data().value;
        }
        
        debugLog(`‚ö†Ô∏è ${collection} n'existe pas`);
        return defaultValue;
      } catch (error) {
        console.error(`‚ùå Erreur chargement ${collection}:`, error);
        return defaultValue;
      }
    };

    // ==================== HELPER FUNCTIONS ====================
    const generateReferralCode = (name) => {
      return `PUFF${name.toUpperCase().substring(0, 3)}${Math.random().toString(36).substring(2, 8).toUpperCase()}`;
    };

    const getLoyaltyTier = (points) => {
      for (let i = LOYALTY_TIERS.length - 1; i >= 0; i--) {
        if (points >= LOYALTY_TIERS[i].minPoints) {
          return LOYALTY_TIERS[i];
        }
      }
      return LOYALTY_TIERS[0];
    };

    const getStatusBadge = (status) => {
      const badges = {
        pending: <span className="bg-orange-500/20 text-orange-400 px-3 py-1 rounded-full text-xs font-bold">‚è≥ En attente</span>,
        confirmed: <span className="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs font-bold">‚úÖ Confirm√©e</span>,
        delivered: <span className="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-bold">üì¶ Livr√©e</span>
      };
      return badges[status] || badges.pending;
    };

    // ==================== ICONS ====================
    const Icon = ({ name, size = 20, className = "" }) => {
      const icons = {
        ShoppingCart: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>,
        Search: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>,
        Plus: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
        Minus: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"/></svg>,
        Eye: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
        Heart: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
        X: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
        Home: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
        Menu: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>,
        LogOut: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
        AlertCircle: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
      };
      return icons[name] || null;
    };

    // ==================== UI COMPONENTS ====================
    const Button = ({ children, onClick, variant = 'primary', className = '', disabled }) => (
      <button onClick={onClick} disabled={disabled} className={`${S.btn} ${S[variant]} ${className}`}>
        {children}
      </button>
    );

    const Input = ({ icon, ...props }) => (
      <div className="relative">
        {icon && <Icon name={icon} size={20} className="absolute left-4 top-1/2 -translate-y-1/2 text-cyan-400" />}
        <input {...props} className={`${S.input} ${icon ? 'pl-12' : ''}`} />
      </div>
    );

    const Card = ({ children, className = '' }) => (
      <div className={`${S.card} ${className}`}>
        {children}
      </div>
    );

    const FuturisticBackground = () => {
      const canvasRef = React.useRef(null);

      React.useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const particles = [];
        const particleCount = 100;

        class Particle {
          constructor() {
            this.reset();
          }

          reset() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2 + 1;
            this.speedX = Math.random() * 0.5 - 0.25;
            this.speedY = Math.random() * 0.5 - 0.25;
            this.opacity = Math.random() * 0.5 + 0.2;
          }

          update() {
            this.x += this.speedX;
            this.y += this.speedY;

            if (this.x > canvas.width || this.x < 0) this.speedX *= -1;
            if (this.y > canvas.height || this.y < 0) this.speedY *= -1;
          }

          draw() {
            ctx.fillStyle = `rgba(0, 240, 255, ${this.opacity})`;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
          }
        }

        for (let i = 0; i < particleCount; i++) {
          particles.push(new Particle());
        }

        function animate() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          
          particles.forEach(particle => {
            particle.update();
            particle.draw();
          });

          requestAnimationFrame(animate);
        }

        animate();

        const handleResize = () => {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        };

        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      return (
        <canvas 
          ref={canvasRef} 
          className="fixed inset-0 pointer-events-none z-0"
          style={{ background: 'linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 50%, #0a1a2e 100%)' }}
        />
      );
    };

    // ==================== üî• LOGIN VIEW AM√âLIOR√âE AVEC DEBUGGING ====================
    const LoginView = ({ onLogin, onRegister }) => {
      const [mode, setMode] = useState('login');
      const [rememberMe, setRememberMe] = useState(false);
      const [form, setForm] = useState({ 
        name: '', 
        password: '', 
        confirmPassword: '', 
        phone: '',
        referralCode: '' 
      });
      const [showDebug, setShowDebug] = useState(false);
      
      const handleSubmit = () => {
        debugLog('Tentative de connexion/inscription', { 
          mode, 
          username: form.name,
          passwordLength: form.password?.length 
        });
        
        if (!form.name || !form.password) {
          return alert('Veuillez remplir tous les champs');
        }
        
        if (mode === 'register') {
          if (!form.phone) return alert('Veuillez entrer votre num√©ro de t√©l√©phone');
          if (!form.confirmPassword) return alert('Veuillez confirmer le mot de passe');
          if (form.password !== form.confirmPassword) return alert('Les mots de passe ne correspondent pas');
          if (form.password.length < 6) return alert('Le mot de passe doit contenir au moins 6 caract√®res');
          onRegister(form, rememberMe);
        } else {
          onLogin(form, rememberMe);
        }
      };
      
      return (
        <div className="min-h-screen relative overflow-hidden flex items-center justify-center p-4">
          <FuturisticBackground />
          
          <div className="absolute inset-0 bg-gradient-radial from-cyan-500/10 via-transparent to-transparent pointer-events-none" />
          
          <Card className="p-8 max-w-md w-full relative z-10 animate-fadeIn">
            <div className="text-center mb-8">
              <div className="w-32 h-32 mx-auto mb-4 relative">
                <div className="absolute inset-0 bg-cyan-500/20 blur-3xl rounded-full animate-pulse" />
                <img 
                  src="https://i.postimg.cc/ZRscyVKS/b4beb632-78c8-4f8d-8491-02da1b2545ee.png" 
                  alt="P-Shop Logo" 
                  className="w-full h-full object-contain drop-shadow-[0_0_30px_rgba(0,240,255,0.8)] relative z-10"
                />
              </div>
              
              <h1 className="text-5xl font-black mb-2 animate-glow">
                <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-pink-400 to-purple-400">
                  P-SHOP
                </span>
              </h1>
              <p className="text-cyan-300 text-sm">Votre boutique de Puff futuriste</p>
              
              {/* üîç BOUTON DEBUG */}
              <button
                onClick={() => setShowDebug(!showDebug)}
                className="mt-2 text-xs text-cyan-400/50 hover:text-cyan-400"
              >
                {showDebug ? 'üîí Masquer debug' : 'üîç Mode debug'}
              </button>
            </div>
            
            <div className="flex gap-2 mb-6">
              <Button 
                onClick={() => setMode('login')} 
                variant={mode === 'login' ? 'primary' : 'secondary'} 
                className="flex-1"
              >
                Connexion
              </Button>
              <Button 
                onClick={() => setMode('register')} 
                variant={mode === 'register' ? 'primary' : 'secondary'} 
                className="flex-1"
              >
                Inscription
              </Button>
            </div>
            
            {showDebug && (
              <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 mb-4 text-xs text-yellow-300">
                <p className="font-bold mb-1">üîç Mode Debug Actif</p>
                <p>Mode: {mode}</p>
                <p>Username: {form.name || '(vide)'}</p>
                <p>Password: {form.password ? '‚óè'.repeat(form.password.length) : '(vide)'}</p>
                <p className="text-yellow-400 mt-2">
                  ‚ö†Ô∏è V√©rifiez la console (F12) pour plus de d√©tails
                </p>
              </div>
            )}
            
            <div className="space-y-3">
              <Input 
                type="text" 
                placeholder="Identifiant" 
                value={form.name} 
                onChange={e => setForm({...form, name: e.target.value})} 
              />
              
              {mode === 'register' && (
                <Input 
                  type="tel" 
                  placeholder="Num√©ro de t√©l√©phone" 
                  value={form.phone} 
                  onChange={e => setForm({...form, phone: e.target.value})} 
                />
              )}
              
              <Input 
                type="password" 
                placeholder="Mot de passe" 
                value={form.password} 
                onChange={e => setForm({...form, password: e.target.value})} 
              />
              
              {mode === 'register' && (
                <>
                  <Input 
                    type="password" 
                    placeholder="Confirmer le mot de passe" 
                    value={form.confirmPassword} 
                    onChange={e => setForm({...form, confirmPassword: e.target.value})} 
                  />
                  <Input 
                    type="text" 
                    placeholder="Code parrainage (optionnel)" 
                    value={form.referralCode} 
                    onChange={e => setForm({...form, referralCode: e.target.value.toUpperCase()})} 
                  />
                </>
              )}
              
              <Button onClick={handleSubmit} className="w-full">
                {mode === 'login' ? 'SE CONNECTER' : 'CR√âER COMPTE'}
              </Button>
              
              <div className="flex items-center gap-2 mt-4">
                <input
                  type="checkbox"
                  id="rememberMe"
                  checked={rememberMe}
                  onChange={(e) => setRememberMe(e.target.checked)}
                  className="w-4 h-4 accent-cyan-500 cursor-pointer"
                />
                <label htmlFor="rememberMe" className="text-cyan-300 text-sm cursor-pointer">
                  Rester connect√© sur cet appareil
                </label>
              </div>
            </div>
            
            <p className="text-cyan-300/70 text-xs text-center mt-6">
              Vendeur: B-K
            </p>
          </Card>

          <style jsx>{`
            @keyframes fadeIn {
              from { opacity: 0; transform: translateY(20px); }
              to { opacity: 1; transform: translateY(0); }
            }
            @keyframes glow {
              0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 240, 255, 0.5)); }
              50% { filter: drop-shadow(0 0 20px rgba(0, 240, 255, 0.8)); }
            }
            .animate-fadeIn {
              animation: fadeIn 0.6s ease-out;
            }
            .animate-glow {
              animation: glow 2s ease-in-out infinite;
            }
          `}</style>
        </div>
      );
    };

    // ==================== MINI APP POUR TEST ====================
    function App() {
      const INITIAL_USERS = [
        { 
          name: 'Bradley', 
          password: 'Brad@mar270508', 
          role: 'producer', 
          phone: '', 
          referralCode: 'PUFFBRA123456',
          points: 0
        },
        { 
          name: 'Kmb',
          password: 'Kmb123456',
          role: 'producer', 
          phone: '', 
          referralCode: 'PUFFVEN789012',
          points: 0
        }
      ];

      const [user, setUser] = useState(null);
      const [users, setUsers] = useState(INITIAL_USERS);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const loadData = async () => {
          setLoading(true);
          try {
            debugLog('üîÑ Chargement des utilisateurs...');
            
            const loadedUsers = await loadFromFirestore('pshop_users', null);
            
            if (!loadedUsers || loadedUsers.length === 0) {
              debugLog('‚ö†Ô∏è Aucun utilisateur trouv√©, initialisation...');
              await saveToFirestore('pshop_users', INITIAL_USERS);
              setUsers(INITIAL_USERS);
            } else {
              debugLog(`‚úÖ ${loadedUsers.length} utilisateurs charg√©s`);
              
              // Log chaque utilisateur pour v√©rifier
              loadedUsers.forEach(u => {
                debugLog(`User: ${u.name}`, {
                  hasPassword: !!u.password,
                  passwordLength: u.password?.length,
                  passwordPreview: u.password ? u.password.substring(0, 3) + '***' : 'NONE'
                });
              });
              
              setUsers(loadedUsers);
            }
            
            const savedUsername = localStorage.getItem('pshop_remember_user');
            if (savedUsername) {
              debugLog('Tentative connexion auto:', savedUsername);
              const savedUser = (loadedUsers || INITIAL_USERS).find(u => u.name === savedUsername);
              if (savedUser) {
                debugLog('‚úÖ Connexion auto r√©ussie');
                setUser(savedUser);
              }
            }
          } catch (error) {
            console.error('‚ùå Erreur chargement:', error);
          } finally {
            setLoading(false);
          }
        };
        loadData();
      }, []);

      // üî• FONCTION LOGIN AM√âLIOR√âE AVEC DEBUGGING
      const handleLogin = useCallback(async (form, rememberMe) => {
        debugLog('üîê Tentative de connexion', {
          username: form.name,
          passwordProvided: !!form.password,
          totalUsers: users.length
        });
        
        // Recherche de l'utilisateur
        const foundUser = users.find(u => {
          const nameMatch = u.name === form.name;
          debugLog(`V√©rification utilisateur: ${u.name}`, {
            nameMatch,
            hasStoredPassword: !!u.password,
            storedPasswordLength: u.password?.length,
            providedPasswordLength: form.password?.length
          });
          return nameMatch;
        });
        
        if (!foundUser) {
          debugLog('‚ùå Utilisateur non trouv√©', { searchedName: form.name });
          return alert('Identifiant ou mot de passe incorrect\n\n‚ÑπÔ∏è Utilisateur non trouv√© dans la base');
        }
        
        debugLog('‚úÖ Utilisateur trouv√©', {
          name: foundUser.name,
          hasPassword: !!foundUser.password,
          passwordMatch: foundUser.password === form.password
        });
        
        // V√©rification du mot de passe avec trim pour √©viter les espaces
        const passwordMatch = foundUser.password?.trim() === form.password?.trim();
        
        if (!passwordMatch) {
          debugLog('‚ùå Mot de passe incorrect', {
            expected: foundUser.password ? 'EXISTS' : 'NONE',
            received: form.password ? 'PROVIDED' : 'NONE',
            expectedLength: foundUser.password?.length,
            receivedLength: form.password?.length
          });
          return alert(`Identifiant ou mot de passe incorrect\n\nüîç Debug:\n- Mot de passe enregistr√©: ${foundUser.password ? 'OUI' : 'NON'}\n- Longueur attendue: ${foundUser.password?.length || 0}\n- Longueur fournie: ${form.password?.length || 0}`);
        }
        
        // Connexion r√©ussie
        debugLog('‚úÖ CONNEXION R√âUSSIE', { username: foundUser.name });
        setUser(foundUser);
        
        if (rememberMe) {
          localStorage.setItem('pshop_remember_user', foundUser.name);
          debugLog('‚úÖ Rester connect√© activ√©');
        } else {
          localStorage.removeItem('pshop_remember_user');
        }
        
        alert(`‚úÖ Bienvenue ${foundUser.name} !`);
      }, [users]);

      const handleRegister = useCallback(async (form, rememberMe) => {
        debugLog('üìù Tentative d\'inscription', { username: form.name });
        
        if (users.find(u => u.name === form.name)) {
          return alert('‚ùå Ce nom d\'utilisateur existe d√©j√†');
        }
        
        const newUser = {
          name: form.name,
          password: form.password,
          phone: form.phone,
          role: 'client',
          referralCode: generateReferralCode(form.name),
          referredBy: form.referralCode || null,
          points: 0
        };

        const updatedUsers = [...users, newUser];
        setUsers(updatedUsers);
        
        await saveToFirestore('pshop_users', updatedUsers);
        
        if (rememberMe) {
          localStorage.setItem('pshop_remember_user', newUser.name);
        }
        
        setUser(newUser);
        
        debugLog('‚úÖ Inscription r√©ussie', { username: newUser.name });
        alert(`Bienvenue ${form.name} ! üéâ`);
      }, [users]);

      const handleLogout = useCallback(() => {
        localStorage.removeItem('pshop_remember_user');
        setUser(null);
        debugLog('‚úÖ D√©connexion r√©ussie');
      }, []);

      if (loading) {
        return (
          <div className="min-h-screen relative overflow-hidden flex items-center justify-center">
            <FuturisticBackground />
            <Card className="p-12 text-center relative z-10">
              <div className="w-32 h-32 mx-auto mb-4">
                <img 
                  src="https://i.postimg.cc/ZRscyVKS/b4beb632-78c8-4f8d-8491-02da1b2545ee.png" 
                  alt="P-Shop Logo" 
                  className="w-full h-full object-contain drop-shadow-[0_0_30px_rgba(0,240,255,0.8)] animate-pulse"
                />
              </div>
              <p className="text-cyan-300 text-lg">Chargement depuis Firebase...</p>
            </Card>
          </div>
        );
      }

      if (!user) {
        return <LoginView onLogin={handleLogin} onRegister={handleRegister} />;
      }

      return (
        <div className="min-h-screen relative overflow-hidden">
          <FuturisticBackground />
          
          <div className="relative z-10 p-6">
            <Card className="max-w-2xl mx-auto p-8">
              <div className="text-center">
                <div className="w-24 h-24 mx-auto mb-4">
                  <img 
                    src="https://i.postimg.cc/ZRscyVKS/b4beb632-78c8-4f8d-8491-02da1b2545ee.png" 
                    alt="P-Shop" 
                    className="w-full h-full object-contain drop-shadow-[0_0_20px_rgba(0,240,255,0.8)]"
                  />
                </div>
                <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-pink-400 mb-4">
                  ‚úÖ CONNEXION R√âUSSIE !
                </h1>
                <p className="text-cyan-300 text-xl mb-2">
                  Bienvenue <span className="text-white font-bold">{user.name}</span>
                </p>
                <p className="text-cyan-400 mb-6">
                  R√¥le: {user.role === 'producer' ? 'üë®‚Äçüíº Producteur' : 'üë§ Client'}
                </p>
                
                <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-6 mb-6">
                  <div className="flex items-center justify-center gap-2 mb-3">
                    <Icon name="AlertCircle" size={24} className="text-green-400" />
                    <p className="text-green-400 font-bold">Le syst√®me de connexion fonctionne parfaitement !</p>
                  </div>
                  <p className="text-green-300 text-sm">
                    Vous pouvez maintenant remplacer ce fichier par votre code complet.
                  </p>
                </div>
                
                <Button onClick={handleLogout} className="w-full">
                  <Icon name="LogOut" size={20} />
                  D√âCONNEXION
                </Button>
                
                <div className="mt-6 p-4 bg-cyan-500/10 border border-cyan-500/30 rounded-xl text-left text-xs text-cyan-300">
                  <p className="font-bold mb-2">üìã Informations de debug:</p>
                  <p>‚Ä¢ Total utilisateurs en base: {users.length}</p>
                  <p>‚Ä¢ Votre ID: {user.name}</p>
                  <p>‚Ä¢ Code parrainage: {user.referralCode}</p>
                  <p>‚Ä¢ Points: {user.points || 0}</p>
                </div>
              </div>
            </Card>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
